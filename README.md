# snap-client-go

## Overview

This repo contains the Go client generated by [go-swagger](https://github.com/go-swagger/go-swagger). 

You can browse and test Snap APIs interactively by leveraging tools:

* [go-swagger](https://github.com/go-swagger/go-swagger)
  * Run the following command at the root of [Snap](https://github.com/intelsdi-x/snap) repo:
    > swagger serve swagger.json --host=127.0.0.1
* [swagger-ui](https://github.com/swagger-api/swagger-ui)
* [apistudio.io](http://apistudio.io/)

:fire: Package **`client`** and **`models`** inside this repo require no modification at all.

## Generating new client
If you like to generate a new client when there are changes in [Snap](https://github.com/intelsdi-x/snap) APIs, simply do following:

* Update snap version in glide.yaml
* Run command `make`

Note that the command `make` deletes:boom: both `client` and `models` packages and regenerate them to the Snap API version provided in the glide.yaml.

## Creating client

You may create a default client or a custom client.

### Default client

```sh
  c := client.NewHTTPClient(nil)
```

### Custom client

```sh
  c := client.NewHTTPClientWithConfig(nil, &client.TransportConfig{
		Host:     "http://example.com:80",
		BasePath: "/v2",
		Schemes:  []string{"http"},
	})
```

## Writing operations

For API operations, simply do following with appropriate parameters. Let's assume `c` is the client created and examples are:

### Get plugins

```sh
getPlugins, err := c.Plugins.GetPlugins(snap.NewGetPluginsParams())
```

### Get a plugin

```sh
params := plugins.NewGetPluginParams()
params.SetPtype("collector")
params.SetPname("mock")
params.SetPversion(int64(1))

getPlugin, err := c.Plugins.GetPlugin(params)
```

### Load a plugin

```sh
params := plugins.NewLoadPluginParams()
params.SetPluginData(<*os.file>)

loadPlugin, err := c.Plugins.LoadPlugin(params)
```

### Unload a plugin

```sh
params := plugins.NewUnloadPluginParams()
params.SetPtype("collector")
params.SetPname("mock")
params.SetPversion(int64(1))

unloadPlugin, err := c.Plugins.UnloadPlugin(params)
```

### Get a plugin config

```sh
params := plugins.NewGetPluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))

getPluginConfig, err := c.Plugins.GetPluginConfigItem(params)
```

### Update a plugin config

```sh
cfg := `{"user":"jean","someint":1234567,"somefloat":3.1418,"somebool":false}`

params := plugins.NewSetPluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))
params.SetConfig(&cfg)

setPluginConfig, err := c.Plugins.SetPluginConfigItem(params)
```

### Delete a plugin config

```sh
params := plugins.NewDeletePluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))
params.SetConfig([]string{"somefloat", "someint"})

deletePluginConfig, err := c.Plugins.DeletePluginConfigItem(params)
```

### Get metrics

```sh
params := plugins.NewGetMetricsParams()

getMetrics, err := c.Plugins.GetMetrics(params)
```

### Get metrics giving a namespace

```sh
ns := "/intel/mock/bar"
params := plugins.NewGetMetricsParams()
params.SetNs(&ns)

getMetrics, err := c.Plugins.GetMetrics(params)
```

### Get a metric

```sh
ns := "/intel/mock/bar"
ver := int64(1)
params := plugins.NewGetMetricsParams()
params.SetNs(&ns)
params.SetVer(&ver)

getMetric, err := c.Plugins.GetMetrics(params)
```

### Get tasks

```sh
params := tasks.NewGetTasksParams()

getTasks, err := c.Tasks.GetTasks(params)
```

### Get a task

```sh
params := tasks.NewGetTaskParams()
params.SetID(id)

getTask, err := c.Tasks.GetTask(params)
```

### Create a task

```sh
params := tasks.NewAddTaskParams()
params.SetTask(<task manifest> || <workflow manifest>)

createTask, err := c.Tasks.AddTask(params)
```

### Start a task

```sh
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("start")

startTask, err := c.Tasks.UpdateTaskState(params)
```

### Stop a task

```sh
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("stop")

stopTask, err := c.Tasks.UpdateTaskState(params)
```

### Enable a task

```sh
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("enable")

enableTask, err := c.Tasks.UpdateTaskState(params)
```

### Remove a task

```sh
params := tasks.NewRemoveTaskParams()
params.SetID(<task id>)

removeTask, err := c.Tasks.RemoveTask(params)
```

## Running tests

The package `test` contains integration tests that verify the generated client library if it is working appropriately against the actual behavior of the Snap APIs. Tests will fail if any incompatible change in the API.

For your convenience, the Docker and docker-compose based medium test is available for you to try out.  At the root package, you can run:  

```sh
make test-medium
```

## Security Disclosure

The Snap team takes security very seriously. If you have any issue regarding security, please notify us by sending an email to snap-security@intel.com
and not by creating a GitHub issue. We will follow up with you promptly with more information and a plan for remediation.

## License
Snap Client Go is Open Source software released under the [Apache 2.0 License](LICENSE).

## Thank You
And **thank you!** Your contribution, through code and participation, is incredibly important to us.