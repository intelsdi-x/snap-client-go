# snap-client-go

## Overview

This repo contains Snap REST API V2 Go client generated by [go-swagger](https://github.com/go-swagger/go-swagger). 

You can browse Snap REST API V2 by running the command below against [Snap REST API V2 Specification](https://github.com/intelsdi-x/snap/blob/master/swagger.json).

  > swagger serve swagger.json --host=127.0.0.1

:fire: Package **`client`** and **`models`** are generated by go-swagger. They require no modification at all.

## Generating new client
If you like to generate a new client when there are changes in [Snap](https://github.com/intelsdi-x/snap) APIs, simply do following:

* Run command `make`

Note that the command `make` deletes:boom: both `client` and `models` packages and regenerate them to the Snap API version provided in the glide.yaml.

## Creating client

You may create a default client or a custom client like examples below.  The code in `tests` package may use as examples as well.

### Default client

```go
  c := client.NewHTTPClient(nil)
```

### Custom client

```go
  c := client.NewHTTPClientWithConfig(nil, &client.TransportConfig{
		Host:     "http://example.com:80",
		BasePath: "/v2",
		Schemes:  []string{"http"},
	})
```

## Writing operations

You can provide basic authentication info for each API. The following examples assume that basic auth is `nil`. Let's consider `c` is the client created, and examples are:

### Get plugins

```go
getPlugins, err := c.Plugins.GetPlugins(snap.NewGetPluginsParams())
```

### Get a plugin

```go
params := plugins.NewGetPluginParams()
params.SetPtype("collector")
params.SetPname("mock")
params.SetPversion(int64(1))

getPlugin, err := c.Plugins.GetPlugin(params, nil)
```

### Load a plugin

```go
params := plugins.NewLoadPluginParams()
params.SetPluginData(<*os.file>)

loadPlugin, err := c.Plugins.LoadPlugin(params, nil)
```

### Unload a plugin

```go
params := plugins.NewUnloadPluginParams()
params.SetPtype("collector")
params.SetPname("mock")
params.SetPversion(int64(1))

unloadPlugin, err := c.Plugins.UnloadPlugin(params, nil)
```

### Get a plugin config

```go
params := plugins.NewGetPluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))

getPluginConfig, err := c.Plugins.GetPluginConfigItem(params, nil)
```

### Update a plugin config

```go
cfg := `{"user":"jean","someint":1234567,"somefloat":3.1418,"somebool":false}`

params := plugins.NewSetPluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))
params.SetConfig(&cfg)

setPluginConfig, err := c.Plugins.SetPluginConfigItem(params, nil)
```

### Delete a plugin config

```go
params := plugins.NewDeletePluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))
params.SetConfig([]string{"somefloat", "someint"})

deletePluginConfig, err := c.Plugins.DeletePluginConfigItem(params, nil)
```

### Get metrics

```go
params := plugins.NewGetMetricsParams()
getMetrics, err := c.Plugins.GetMetrics(params, nil)
```

### Get metrics giving a namespace

```go
ns := "/intel/mock/bar"
params := plugins.NewGetMetricsParams()
params.SetNs(&ns)

getMetrics, err := c.Plugins.GetMetrics(params, nil)
```

### Get a metric

```go
ns := "/intel/mock/bar"
ver := int64(1)
params := plugins.NewGetMetricsParams()
params.SetNs(&ns)
params.SetVer(&ver)

getMetric, err := c.Plugins.GetMetrics(params, nil)
```

### Get tasks

```go
params := tasks.NewGetTasksParams()

getTasks, err := c.Tasks.GetTasks(params)
```

### Get a task

```go
params := tasks.NewGetTaskParams()
params.SetID(id)

getTask, err := c.Tasks.GetTask(params, nil)
```

### Create a task

```go
params := tasks.NewAddTaskParams()
params.SetTask(<task manifest> || <workflow manifest>)

createTask, err := c.Tasks.AddTask(params, nil)
```

### Start a task

```go
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("start")

startTask, err := c.Tasks.UpdateTaskState(params, nil)
```

### Stop a task

```go
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("stop")

stopTask, err := c.Tasks.UpdateTaskState(params, nil)
```

### Enable a task

```go
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("enable")

enableTask, err := c.Tasks.UpdateTaskState(params, nil)
```

### Remove a task

```go
params := tasks.NewRemoveTaskParams()
params.SetID(<task id>)

removeTask, err := c.Tasks.RemoveTask(params, nil)
```

## Running tests

The package `test` contains integration tests that verify the generated client library if it is working appropriately against the actual behavior of the Snap REST API V2. Tests will fail if any incompatible change in the API.

For your convenience, the Docker and docker-compose based medium test is available for you to try out.  At the root package, you can run:  

```sh
make test-medium
```

### Become a Maintainer

snap-cli maintainers are here to help guide this project, and the community forward in a positive direction. Maintainers of Snap and the Intel created plugins are selected based on contributions to the project and recommendations from other maintainers. The full list of active maintainers can be found [here](https://github.com/intelsdi-x/snap/blob/master/docs/MAINTAINERS.md).

Interested in becoming a maintainer? Check out [Responsibilities of a Maintainer](https://github.com/intelsdi-x/snap/blob/master/docs/MAINTAINERS.md#responsibilities-of-maintainers) and open an issue [here](https://github.com/intelsdi-x/snap/issues/new?title=interested+in+becoming+a+maintainer&body=About+me) to discuss your interest.


## Code of Conduct

All contributors to snap-cli are expected to be helpful and encouraging to all members of the community, treating everyone with a high level of professionalism and respect. See our [code of conduct](https://github.com/intelsdi-x/snap/blob/master/CODE_OF_CONDUCT.md) for more details.


## Security Disclosure

The Snap team takes security very seriously. If you have any issue regarding security, please notify us by sending an email to snap-security@intel.com
and not by creating a GitHub issue. We will follow up with you promptly with more information and a plan for remediation.

## License

Snap Client Go is Open Source software released under the [Apache 2.0 License](LICENSE).

## Thank You

And **thank you!** Your contribution, through code and participation, is incredibly important to us.