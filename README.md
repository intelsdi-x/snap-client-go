<!--
http://www.apache.org/licenses/LICENSE-2.0.txt


Copyright 2017 Intel Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

[![Build Status](https://travis-ci.org/intelsdi-x/snap-client-go.svg?branch=master)](https://travis-ci.org/intelsdi-x/snap-client-go) 

# snap-client-go
This repo contains Snap REST API V2 Go client generated by [go-swagger](https://github.com/go-swagger/go-swagger). 

You can browse Snap REST API V2 by running the command below against [Snap REST API V2 Specification](https://github.com/intelsdi-x/snap/blob/master/swagger.json).

  > swagger serve swagger.json --host=127.0.0.1

Package **`client`** and **`models`** are generated by go-swagger. They require no modification at all.

## Topics

* [Generating New Client](#generating-new-client)
* [Creating Client](#creating-client)
  * [Default Client](#default-client)
  * [Custom Client](#custom-client)
* [Writing Operations](#writing-operations)
  * [Get Plugins](#get-plugins)
  * [Get A Plugin](#get-a-plugin)
  * [Load A Plugin](#load-a-plugin)
  * [Unload A Plugin](#unload-a-plugin)
  * [Get A Plugin Config](#get-a-plugin-config)
  * [Update A Plugin Config](#update-a-plugin-config)
  * [Delete A Plugin Config](#delete-a-plugin-config)
  * [Get Metrics](#get-metrics)
  * [Get Metrics Giving A Namespace](#get-metrics-giving-a-namespace)
  * [Get A Metric](#get-a-metric)
  * [Get Tasks](#get-tasks)
  * [Get A Task](#get-a-task)
  * [Create A Task](#create-a-task)
  * [Start A Task](#start-a-task)
  * [Stop A Task](#stop-a-task)
  * [Enable A Task](#enable-a-task)
  * [Remove A Task](#remove-a-task)
* [Running tests](#running-tests)
* [Community Support](#community-support)
* [Contributing](#contributing)
* [Code of Conduct](#code-of-conduct)
* [Security Disclosure](#security-disclosure)
* [License](license)
* [Thank You](thank-you)

## Generating New Client

If you like to generate a new client when there are changes in [Snap](https://github.com/intelsdi-x/snap) APIs, simply do following:

* Run command `make`

Note that the command `make` DELETES both `client` and `models` packages and regenerate them to the Snap API version provided in the glide.yaml.

## Creating Client

You may create a default client or a custom client like examples below.  The code in `tests` package may use as examples as well.

### Default Client

```go
  c := client.NewHTTPClient(nil)
```

### Custom Client

```go
  c := client.NewHTTPClientWithConfig(nil, &client.TransportConfig{
		Host:     "http://example.com:80",
		BasePath: "/v2",
		Schemes:  []string{"http"},
	})
```

## Writing Operations

You can provide basic authentication info for each API. The following examples assume that basic auth is `nil`. Let's consider `c` is the client created, and examples are:

### Get Plugins

```go
getPlugins, err := c.Plugins.GetPlugins(snap.NewGetPluginsParams())
```

### Get A Plugin

```go
params := plugins.NewGetPluginParams()
params.SetPtype("collector")
params.SetPname("mock")
params.SetPversion(int64(1))

getPlugin, err := c.Plugins.GetPlugin(params, nil)
```

### Load A Plugin

```go
params := plugins.NewLoadPluginParams()
params.SetPluginData(<*os.file>)

loadPlugin, err := c.Plugins.LoadPlugin(params, nil)
```

### Unload A Plugin

```go
params := plugins.NewUnloadPluginParams()
params.SetPtype("collector")
params.SetPname("mock")
params.SetPversion(int64(1))

unloadPlugin, err := c.Plugins.UnloadPlugin(params, nil)
```

### Get A Plugin Config

```go
params := plugins.NewGetPluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))

getPluginConfig, err := c.Plugins.GetPluginConfigItem(params, nil)
```

### Update A Plugin Config

```go
cfg := `{"user":"jean","someint":1234567,"somefloat":3.1418,"somebool":false}`

params := plugins.NewSetPluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))
params.SetConfig(&cfg)

setPluginConfig, err := c.Plugins.SetPluginConfigItem(params, nil)
```

### Delete A Plugin Config

```go
params := plugins.NewDeletePluginConfigItemParams()
params.SetPname("mock")
params.SetPtype("collector")
params.SetPversion(int64(1))
params.SetConfig([]string{"somefloat", "someint"})

deletePluginConfig, err := c.Plugins.DeletePluginConfigItem(params, nil)
```

### Get Metrics

```go
params := plugins.NewGetMetricsParams()
getMetrics, err := c.Plugins.GetMetrics(params, nil)
```

### Get Metrics Giving A Namespace

```go
ns := "/intel/mock/bar"
params := plugins.NewGetMetricsParams()
params.SetNs(&ns)

getMetrics, err := c.Plugins.GetMetrics(params, nil)
```

### Get A Metric

```go
ns := "/intel/mock/bar"
ver := int64(1)
params := plugins.NewGetMetricsParams()
params.SetNs(&ns)
params.SetVer(&ver)

getMetric, err := c.Plugins.GetMetrics(params, nil)
```

### Get Tasks

```go
params := tasks.NewGetTasksParams()

getTasks, err := c.Tasks.GetTasks(params)
```

### Get A Task

```go
params := tasks.NewGetTaskParams()
params.SetID(id)

getTask, err := c.Tasks.GetTask(params, nil)
```

### Create A Task

```go
params := tasks.NewAddTaskParams()
params.SetTask(<task manifest> || <workflow manifest>)

createTask, err := c.Tasks.AddTask(params, nil)
```

### Start A Task

```go
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("start")

startTask, err := c.Tasks.UpdateTaskState(params, nil)
```

### Stop A Task

```go
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("stop")

stopTask, err := c.Tasks.UpdateTaskState(params, nil)
```

### Enable A Task

```go
params := tasks.NewUpdateTaskStateParams()
params.SetID(<task id>)
params.SetAction("enable")

enableTask, err := c.Tasks.UpdateTaskState(params, nil)
```

### Remove A Task

```go
params := tasks.NewRemoveTaskParams()
params.SetID(<task id>)

removeTask, err := c.Tasks.RemoveTask(params, nil)
```

## Running tests

The package `test` contains integration tests that verify the generated client library if it is working appropriately against the actual behavior of the Snap REST API V2. Tests will fail if any incompatible change in the API.

For your convenience, the Docker and docker-compose based medium test is available for you to try out.  At the root package, you can run:  

```sh
make test-medium
```

## Community Support

This repository is one of many in the Snap framework and [has maintainers supporting it](https://github.com/intelsdi-x/snap/blob/master/docs/MAINTAINERS.md). We love contributions from our community along the way. No improvement is too small.


## Contributing

We encourage contributions from the community.

* _Contributors_: We always appreciate more eyes on the core framework and Snap CLIs
* _Feedback_: try it and tell us about it on [our Slack team](https://intelsdi-x.herokuapp.com/) or through [a blog posts](https://medium.com/intel-sdi/)
* _Integrations_: snap-cli uses [snap-client-go](https://github.com/intelsdi-x/snap-client-go)

To contribute to the Snap framework, see our [CONTRIBUTING.md](CONTRIBUTING.md) file. To give back to a specific plugin, open an issue on its repository. Snap maintainers aim to address comments and questions as quickly as possible. To get some attention on an issue, reach out to us [on Slack](http://slack.snap-telemetry.io), or open an issue to get a conversation started.


## Code of Conduct

All contributors to snap-cli are expected to be helpful and encouraging to all members of the community, treating everyone with a high level of professionalism and respect. See our [code of conduct](https://github.com/intelsdi-x/snap/blob/master/CODE_OF_CONDUCT.md) for more details.


## Security Disclosure

The Snap team takes security very seriously. If you have any issue regarding security, please notify us by sending an email to snap-security@intel.com
and not by creating a GitHub issue. We will follow up with you promptly with more information and a plan for remediation.

## License

Snap Client Go is an Open Source software released under the [Apache 2.0 License](LICENSE).

## Thank You

And **thank you!** Your contribution, through code and participation, is incredibly important to us.
